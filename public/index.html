<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
    <title>Babylon - Getting Started</title>
    <!--- Link to the last version of BabylonJS --->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <style>
        html, body {
            overflow: hidden;
            width   : 100%;
            height  : 100%;
            margin  : 0;
            padding : 0;
        }

        #renderCanvas {
            width   : 100%;
            height  : 100%;
            touch-action: none;
        }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        window.addEventListener('DOMContentLoaded', async function(){
            // get the canvas DOM element
            var canvas = document.getElementById('renderCanvas');

            // load the 3D engine
            var engine = new BABYLON.Engine(canvas, true);

            var createScene = async function () {

                var scene = new BABYLON.Scene(engine);

                // Lights
                var light0 = new BABYLON.DirectionalLight("Omni", new BABYLON.Vector3(-2, -5, 2), scene);
                var light1 = new BABYLON.PointLight("Omni", new BABYLON.Vector3(2, -5, -2), scene);

                // Need a free camera for collisions
                var camera = new BABYLON.FreeCamera("FreeCamera", new BABYLON.Vector3(0, 1.6, 0), scene);
                camera.attachControl(canvas, true);
                camera.keysUp.push(87); // "w"
            	camera.keysDown.push(83); // "s"
                camera.keysLeft.push(65); // "a"
                camera.keysRight.push(68); // "d"
                camera.speed = .1;

                //Ground
                var ground = BABYLON.Mesh.CreatePlane("ground", 20.0, scene);
                ground.material = new BABYLON.StandardMaterial("groundMat", scene);
                ground.material.diffuseColor = new BABYLON.Color3(1, 1, 1);
                ground.material.backFaceCulling = false;
                ground.rotation = new BABYLON.Vector3(Math.PI / 2, 0, 0);
                ground.position = new BABYLON.Vector3(0, 0, 0);

                //Simple crate
                var box = BABYLON.Mesh.CreateBox("crate", 2, scene);
                box.material = new BABYLON.StandardMaterial("Mat", scene);
                box.material.diffuseTexture = new BABYLON.Texture("textures/crate.png", scene);
                box.material.diffuseTexture.hasAlpha = true;
                box.position = new BABYLON.Vector3(3, 1, 8);

                // Skybox
                var skybox = BABYLON.Mesh.CreateBox("skyBox", 100.0, scene);
                var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
                skyboxMaterial.emissiveColor = new BABYLON.Color3(.8, .8, 1);
                skyboxMaterial.backFaceCulling = false;
                skyboxMaterial.disableLighting = true;
                skybox.material = skyboxMaterial;
                skybox.infiniteDistance = true;

                //Set gravity for the scene (G force like, on Y-axis)
                scene.gravity = new BABYLON.Vector3(0, -0.9, 0);

                // Enable Collisions
                scene.collisionsEnabled = true;

                //Then apply collisions and gravity to the active camera
                camera.checkCollisions = true;
                camera.applyGravity = true;

                //Set the ellipsoid around the camera (e.g. your player's size)
                camera.ellipsoid = new BABYLON.Vector3(.5, .8, .25);
                camera.minZ = .15;

                //finally, say which mesh will be collisionable
                ground.checkCollisions = true;
                box.checkCollisions = true;

                const xr = await scene.createDefaultXRExperienceAsync({
                    floorMeshes: [ground]
                });

                return scene;
            };

            // call the createScene function
            var scene = await createScene();

            // run the render loop
            engine.runRenderLoop(function(){
                scene.render();
            });

            // the canvas/window resize event handler
            window.addEventListener('resize', function(){
                engine.resize();
            });
        });
    </script>
</body>
</html>